{"version":3,"file":"index.js","sources":["../../../src/application/menu/TJSContextMenu.js"],"sourcesContent":["import { getEasingFunc }      from '#runtime/svelte/easing';\nimport { TJSSvelte }          from '#runtime/svelte/util';\nimport { A11yHelper }         from '#runtime/util/a11y';\nimport { AssetValidator }     from '#runtime/util/browser';\nimport { ThemeObserver }      from '#runtime/util/dom/theme';\nimport { CrossWindow }        from '#runtime/util/browser';\n\nimport {\n   isIterable,\n   isObject }                 from '#runtime/util/object';\n\nimport { TJSContextMenuImpl } from '#standard/component/menu';\n\n/**\n * Provides and manages browser window wide context menu functionality. The best way to create a context menu is to\n * attach the source KeyboardEvent or MouseEvent / PointerEvent as data in {@link TJSContextMenu.create}. This allows\n * proper keyboard handling across browsers supporting the context menu key. A A11yFocusSource data object is generated\n * which allows tracking of the source element that triggered the context menu allowing focus to return to the source\n * when the context menu is closed. This A11yFocusSource object is also forwarded on through the `onPress` callback and\n * is intended to be supplied as `SvelteApplication` options particularly for modal dialogs allowing focus to return\n * to the original source after the modal dialog is closed.\n */\nexport class TJSContextMenu\n{\n   /**\n    * Stores any active context menu.\n    */\n   static #contextMenu = void 0;\n\n   /**\n    * @hideconstructor\n    */\n   constructor()\n   {\n      throw new Error('TJSContextMenu constructor: This is a static class and should not be constructed.');\n   }\n\n   /**\n    * Creates and manages a browser wide context menu. The best way to create the context menu is to pass in the source\n    * DOM event as it is processed for the location of the context menu to display. Likewise, a A11yFocusSource object\n    * is generated that allows focus to be returned to the source location. You may supply a default focus target as a\n    * fallback via `focusEl`.\n    *\n    * @param {object}      opts - Optional parameters.\n    *\n    * @param {KeyboardEvent | MouseEvent}  [opts.event] - The source MouseEvent or KeyboardEvent.\n    *\n    * @param {Iterable<TJSContextMenuItemData>} [opts.items] - Menu items to display.\n    *\n    * @param {number}      [opts.x] - X position override for the top / left of the menu.\n    *\n    * @param {number}      [opts.y] - Y position override for the top / left of the menu.\n    *\n    * @param {number}      [opts.offsetX=2] - Small positive integer offset for context menu so the pointer / mouse is\n    *        over the menu on display.\n    *\n    * @param {number}      [opts.offsetY=2] - Small positive integer offset for context menu so the pointer / mouse is\n    *        over the menu on display.\n    *\n    * @param {Iterable<string>}    [opts.classes] - Additional custom CSS classes to add to the menu. This allows CSS\n    *        style targeting.\n    *\n    * @param {boolean}     [opts.focusDebug] - When true the associated A11yFocusSource object will log focus target\n    *        data when applied.\n    *\n    * @param {HTMLElement|string} [opts.focusEl] - A specific HTMLElement or selector string as the default focus\n    *        target.\n    *\n    * @param {string}      [opts.keyCode='Enter'] - Key to select menu items.\n    *\n    * @param {string}      [opts.id] - A custom CSS ID to add to the menu. This allows CSS style targeting.\n    *\n    * @param {Function}    [opts.onClose] - A function that is invoked when the context menu is closed. Useful for any\n    *        state based changes such as CSS highlighting of context menu invoking element.\n    *\n    * @param {{ [key: string]: string | null }}  [opts.styles] - Optional inline styles to apply.\n    *\n    * @param {number}      [opts.duration] - Transition option for duration of transition in milliseconds.\n    *\n    * @param {import('#runtime/svelte/easing').EasingReference}   [opts.easing] - Transition option for ease. Either an\n    *        easing function or easing function name.\n    *\n    * @param {Window}      [opts.activeWindow=globalThis] - The active browser window that the context menu is\n    *        displaying inside.\n    */\n   static create({ event, items, x, y, offsetX = 2, offsetY = 2, focusDebug = false, focusEl,\n    keyCode = 'Enter', classes = [], id = '', onClose, styles, duration = 120, easing, activeWindow })\n   {\n      if (TJSContextMenu.#contextMenu !== void 0) { return; }\n\n      if (!event && (typeof x !== 'number' || typeof y !== 'number'))\n      {\n         throw new Error(`TJSContextMenu.create error: No event or absolute X / Y position not defined.`);\n      }\n\n      if (Number.isInteger(offsetX) && offsetX < 0)\n      {\n         throw new TypeError(`TJSContextMenu.create error: offsetX is not a positive integer.`);\n      }\n\n      if (Number.isInteger(offsetY) && offsetY < 0)\n      {\n         throw new TypeError(`TJSContextMenu.create error: offsetY is not a positive integer.`);\n      }\n\n      if (!Number.isInteger(duration) || duration < 0)\n      {\n         throw new TypeError(`TJSContextMenu.create error: 'duration' is not a positive integer.`);\n      }\n\n      // Perform duck typing on event constructor name.\n      if (event !== void 0 && !CrossWindow.isUserInputEvent(event))\n      {\n         throw new TypeError(\n          `TJSContextMenu.create error: 'event' is not a KeyboardEvent, MouseEvent, or PointerEvent.`);\n      }\n\n      // If `activeWindow` is not defined determine it from the given event.\n      if (activeWindow === void 0 && event !== void 0) { activeWindow = CrossWindow.getWindow(event); }\n\n      if (!CrossWindow.isWindow(activeWindow))\n      {\n         throw new TypeError(`TJSContextMenu.create error: 'activeWindow' is not a Window.`);\n      }\n\n      if (typeof id !== 'string')\n      {\n         throw new TypeError(`TJSContextMenu.create error: 'id' is not a string.`);\n      }\n\n      if (onClose !== void 0 && typeof onClose !== 'function')\n      {\n         throw new TypeError(`TJSContextMenu.create error: 'onClose' is not a function.`);\n      }\n\n      if (!isIterable(classes))\n      {\n         throw new TypeError(`TJSContextMenu.create error: 'classes' is not a list of strings.`);\n      }\n\n      const processedItems = TJSContextMenu.#processItems(items);\n\n      // No applicable menu items. Abort showing the menu.\n      if (processedItems.length === 0) { return; }\n\n      const hasIcon = processedItems.some((entry) => entry['#type'] === 'font' || entry['#type'] === 'svg');\n\n      const focusSource = A11yHelper.getFocusSource({ event, x, y, focusEl, debug: focusDebug });\n\n      const easingFn = getEasingFunc(easing, { default: false });\n\n      // Retrieve any additional platform theme classes depending on event target.\n      const themedClasses = ThemeObserver.nearestThemedTokens({\n         element: event?.target,\n         output: new Set(classes),\n         override: false,\n         strict: true\n      });\n\n      // Create the new context menu with the last click x / y point.\n      TJSContextMenu.#contextMenu = new TJSContextMenuImpl({\n         target: activeWindow.document.body,\n         intro: true,\n         props: {\n            x: focusSource.x,\n            y: focusSource.y,\n            offsetX,\n            offsetY,\n            hasIcon,\n            items: processedItems,\n            classes: Array.from(themedClasses),\n            focusSource,\n            keyCode,\n            id,\n            styles,\n            transitionOptions: { duration, easing: easingFn },\n            activeWindow\n         }\n      });\n\n      TJSContextMenu.#contextMenu.$set({ current_component: TJSContextMenu.#contextMenu });\n\n      // Register an event listener to remove any active context menu if closed from a menu selection or pointer\n      // down event to `document.body`.\n      TJSContextMenu.#contextMenu.$on('close:contextmenu', () =>\n      {\n         TJSContextMenu.#contextMenu = void 0;\n\n         if (typeof onClose === 'function') { onClose(); }\n      });\n   }\n\n   /**\n    * Processes menu item data for conditions and evaluating the type of menu item.\n    *\n    * @param {Iterable<TJSContextMenuItemData>} items - Menu item data.\n    *\n    * @returns {object[]} Processed menu items.\n    */\n   static #processItems(items)\n   {\n      if (!isIterable(items)) { throw new TypeError(`TJSContextMenu error: 'items' is not an iterable list.`); }\n\n      const tempList = items;\n      const tempItems = [];\n\n      let cntr = -1;\n\n      for (const item of tempList)\n      {\n         cntr++;\n         if (!isObject(item)) { throw new TypeError(`TJSContextMenu error: 'item[${cntr}]' is not an object.`); }\n\n         // Filter items for any condition that prevents display.\n         if (typeof item.condition === 'function' && !item.condition()) { continue; }\n         if (typeof item.condition === 'boolean' && !item.condition) { continue; }\n\n         let type;\n\n         if (TJSSvelte.util.isComponent(item.class)) { type = 'class'; }\n         else if (typeof item.icon === 'string')\n         {\n            const result = AssetValidator.parseMedia({ url: item.icon, mediaTypes: AssetValidator.MediaTypes.img_svg });\n            type = result.valid ? result.elementType : 'font';\n         }\n         else if (item.icon === void 0 && typeof item.label === 'string') { type = 'label'; }\n         else if (typeof item.separator === 'string')\n         {\n            if (item.separator !== 'hr')\n            {\n               throw new Error(\n                `TJSContextMenu error: 'item[${cntr}]' has unknown separator type; only 'hr' is currently supported.`);\n            }\n\n            type = 'separator-hr';\n         }\n\n         if (type === void 0) { throw new TypeError(`TJSContextMenu error: Unknown type for 'item[${cntr}]'.`); }\n\n         tempItems.push({ ...item, '#type': type });\n      }\n\n      return tempItems;\n   }\n}\n\n/**\n * @typedef {object} TJSContextMenuItemData Defines a menu item entry. Depending on the item data that is passed\n * into the menu you can define 3 types of items: 'icon / label', 'class / Svelte component', and\n * 'separator / hr'. A single callback function `onPress` is supported.\n *\n * @property {(item: TJSContextMenuItemData, object) => void} [onPress] A callback function that receives the selected\n * item data and an object containing the A11yFocusSource data that can be passed to any Application / particularly\n * modal dialogs returning focus when closed.\n *\n * @property {boolean|(() => boolean)} [condition] If a boolean and false or a function that invoked returns a falsy\n * value this item is not added.\n *\n * @property {Function} [class] A Svelte component class.\n *\n * @property {object} [props] An object passed on as props for any Svelte component.\n *\n * @property {string} [icon] A string containing font icon classes or an image / svg URL path to load.\n *\n * @property {string} [imageAlt] An image 'alt' text description.\n *\n * @property {string} [label] A text string that is passed through localization.\n *\n * @property {'hr'} [separator] A menu item separator; only 'hr' supported.\n */\n"],"names":[],"mappings":"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"}