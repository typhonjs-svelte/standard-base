{"version":3,"file":"index.js","sources":["../../../src/application/menu/TJSContextMenu.js"],"sourcesContent":["import { getEasingFunc }      from '#runtime/svelte/easing';\nimport { TJSSvelteUtil }      from '#runtime/svelte/util';\n\nimport { A11yHelper }         from '#runtime/util/a11y';\n\nimport {\n   isIterable,\n   isObject }                 from '#runtime/util/object';\n\nimport { TJSContextMenuImpl } from '#standard/component/menu';\n\n/**\n * Provides and manages browser window wide context menu functionality. The best way to create a context menu is to\n * attach the source KeyboardEvent or MouseEvent / PointerEvent as data in {@link TJSContextMenu.create}. This allows\n * proper keyboard handling across browsers supporting the context menu key. A A11yFocusSource data object is generated\n * which allows tracking of the source element that triggered the context menu allowing focus to return to the source\n * when the context menu is closed. This A11yFocusSource object is also forwarded on through the `onPress` callback and\n * is intended to be supplied as `SvelteApplication` options particularly for modal dialogs allowing focus to return\n * to the original source after the modal dialog is closed.\n */\nexport class TJSContextMenu\n{\n   /**\n    * Stores any active context menu.\n    */\n   static #contextMenu = void 0;\n\n   /**\n    * Provides the event constructor names to duck type against. This is necessary for when HTML nodes / elements are\n    * moved to another browser window as `instanceof` checks will fail.\n    *\n    * @type {Set<string>}\n    */\n   static #eventTypes = new Set(['KeyboardEvent', 'MouseEvent', 'PointerEvent']);\n\n   /**\n    * Creates and manages a browser wide context menu. The best way to create the context menu is to pass in the source\n    * DOM event as it is processed for the location of the context menu to display. Likewise, a A11yFocusSource object\n    * is generated that allows focus to be returned to the source location. You may supply a default focus target as a\n    * fallback via `focusEl`.\n    *\n    * @param {object}      opts - Optional parameters.\n    *\n    * @param {string}      [opts.id] - A custom CSS ID to add to the menu. This allows CSS style targeting.\n    *\n    * @param {KeyboardEvent | MouseEvent}  [opts.event] - The source MouseEvent or KeyboardEvent.\n    *\n    * @param {number}      [opts.x] - X position override for the top / left of the menu.\n    *\n    * @param {number}      [opts.y] - Y position override for the top / left of the menu.\n    *\n    * @param {number}      [opts.offsetX=2] - Small positive integer offset for context menu so the pointer / mouse is\n    *        over the menu on display.\n    *\n    * @param {number}      [opts.offsetY=2] - Small positive integer offset for context menu so the pointer / mouse is\n    *        over the menu on display.\n    *\n    * @param {Iterable<TJSContextMenuItemData>} [opts.items] - Menu items to display.\n    *\n    * @param {boolean}     [opts.focusDebug] - When true the associated A11yFocusSource object will log focus target\n    *        data when applied.\n    *\n    * @param {HTMLElement|string} [opts.focusEl] - A specific HTMLElement or selector string as the default focus\n    *        target.\n    *\n    * @param {string}      [opts.keyCode='Enter'] - Key to select menu items.\n    *\n    * @param {{ [key: string]: string | null }}  [opts.styles] - Optional inline styles to apply.\n    *\n    * @param {number}      [opts.zIndex=Number.MAX_SAFE_INTEGER - 100] - Z-index for context menu.\n    *\n    * @param {number}      [opts.duration] - Transition option for duration of transition.\n    *\n    * @param {import('#runtime/svelte/easing').EasingReference}   [opts.easing] - Transition option for ease. Either an\n    *        easing function or easing function name.\n    *\n    * @param {Window}      [opts.activeWindow=globalThis] - The active browser window that the context menu is\n    *        displaying inside.\n    */\n   static create({ id = '', event, x, y, items, offsetX = 2, offsetY = 2, focusDebug = false, focusEl,\n    keyCode = 'Enter', styles, zIndex = Number.MAX_SAFE_INTEGER - 100, duration = 200, easing,\n     activeWindow } = {})\n   {\n      if (this.#contextMenu !== void 0) { return; }\n\n      if (!event && (typeof x !== 'number' || typeof y !== 'number'))\n      {\n         throw new Error(`TJSContextMenu.create error: No event or absolute X / Y position not defined.`);\n      }\n\n      if (Number.isInteger(offsetX) && offsetX < 0)\n      {\n         throw new TypeError(`TJSContextMenu.create error: offsetX is not a positive integer.`);\n      }\n\n      if (Number.isInteger(offsetY) && offsetY < 0)\n      {\n         throw new TypeError(`TJSContextMenu.create error: offsetY is not a positive integer.`);\n      }\n\n      // Perform duck typing on event constructor name.\n      if (event !== void 0 && !TJSContextMenu.#eventTypes.has(event?.constructor?.name))\n      {\n         throw new TypeError(\n          `TJSContextMenu.create error: 'event' is not a KeyboardEvent, MouseEvent, or PointerEvent.`);\n      }\n\n      // If `activeWindow` is not defined determine it from the given event or fallback to `globalThis`.\n      if (activeWindow === void 0)\n      {\n         activeWindow = event !== void 0 ? event?.target?.ownerDocument?.defaultView : globalThis;\n      }\n\n      if (Object.prototype.toString.call(activeWindow) !== '[object Window]')\n      {\n         throw new TypeError(`TJSContextMenu.create error: 'activeWindow' is not a Window / WindowProxy.`);\n      }\n\n      const focusSource = A11yHelper.getFocusSource({ event, x, y, focusEl, debug: focusDebug });\n\n      const easingFn = getEasingFunc(easing, { default: false });\n\n      // Create the new context menu with the last click x / y point.\n      this.#contextMenu = new TJSContextMenuImpl({\n         target: activeWindow.document.body,\n         intro: true,\n         props: {\n            id,\n            x: focusSource.x,\n            y: focusSource.y,\n            offsetX,\n            offsetY,\n            items: this.#processItems(items),\n            focusSource,\n            keyCode,\n            styles,\n            transitionOptions: { duration, easing: easingFn },\n            zIndex,\n            activeWindow\n         }\n      });\n\n      this.#contextMenu.$set({ current_component: this.#contextMenu });\n\n      // Register an event listener to remove any active context menu if closed from a menu selection or pointer\n      // down event to `document.body`.\n      this.#contextMenu.$on('close:contextmenu', () => { this.#contextMenu = void 0; });\n   }\n\n   /**\n    * Processes menu item data for conditions and evaluating the type of menu item.\n    *\n    * @param {Iterable<TJSContextMenuItemData>} items - Menu item data.\n    *\n    * @returns {object[]} Processed menu items.\n    */\n   static #processItems(items)\n   {\n      if (!isIterable(items)) { throw new TypeError(`TJSContextMenu error: 'items' is not an iterable list.`); }\n\n      const tempList = items;\n      const tempItems = [];\n\n      let cntr = -1;\n\n      for (const item of tempList)\n      {\n         cntr++;\n         if (!isObject(item)) { throw new TypeError(`TJSContextMenu error: 'item[${cntr}]' is not an object.`); }\n\n         // Filter items for any condition that prevents display.\n         if (typeof item.condition === 'function' && !item.condition()) { continue; }\n         if (typeof item.condition === 'boolean' && !item.condition) { continue; }\n\n         let type;\n\n         if (TJSSvelteUtil.isComponent(item.class)) { type = 'class'; }\n         else if (typeof item.icon === 'string') { type = 'icon'; }\n         else if (typeof item.image === 'string') { type = 'image'; }\n         else if (item.icon === void 0 && item.image === void 0 && typeof item.label === 'string') { type = 'label'; }\n         else if (typeof item.separator === 'string')\n         {\n            if (item.separator !== 'hr')\n            {\n               throw new Error(\n                `TJSContextMenu error: 'item[${cntr}]' has unknown separator type; only 'hr' is currently supported.`);\n            }\n\n            type = 'separator-hr';\n         }\n\n         if (type === void 0) { throw new TypeError(`TJSContextMenu error: Unknown type for 'item[${cntr}]'.`); }\n\n         tempItems.push({ ...item, '#type': type });\n      }\n\n      return tempItems;\n   }\n}\n\n/**\n * @typedef {object} TJSContextMenuItemData Defines a menu item entry. Depending on the item data that is passed\n * into the menu you can define 4 types of items: 'icon / label', 'image / label', 'class / Svelte component', and\n * 'separator / hr'. A single callback function `onPress` is supported.\n *\n * @property {(item: TJSContextMenuItemData, object) => void} [onPress] A callback function that receives the selected\n * item data and an object containing the A11yFocusSource data that can be passed to any Application / particularly\n * modal dialogs returning focus when closed.\n *\n * @property {boolean|(() => boolean)} [condition] If a boolean and false or a function that invoked returns a falsy\n * value this item is not added.\n *\n * @property {Function} [class] A Svelte component class.\n *\n * @property {object} [props] An object passed on as props for any Svelte component.\n *\n *\n * @property {string} [icon] A string containing icon classes.\n *\n *\n * @property {string} [image] An image icon path.\n *\n * @property {string} [imageAlt] An image 'alt' text description.\n *\n *\n * @property {string} [label] A text string that is passed through localization.\n *\n * @property {'hr'} [separator] A menu item separator; only 'hr' supported.\n */\n"],"names":[],"mappings":";;;;;;AAWA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAM,cAAc;AAC3B;AACA;AACA;AACA;AACA,GAAG,OAAO,YAAY,GAAG,KAAK,CAAC,CAAC;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,OAAO,WAAW,GAAG,IAAI,GAAG,CAAC,CAAC,eAAe,EAAE,YAAY,EAAE,cAAc,CAAC,CAAC,CAAC;AACjF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,OAAO,MAAM,CAAC,EAAE,EAAE,GAAG,EAAE,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK,EAAE,OAAO,GAAG,CAAC,EAAE,OAAO,GAAG,CAAC,EAAE,UAAU,GAAG,KAAK,EAAE,OAAO;AACrG,IAAI,OAAO,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,GAAG,MAAM,CAAC,gBAAgB,GAAG,GAAG,EAAE,QAAQ,GAAG,GAAG,EAAE,MAAM;AAC7F,KAAK,YAAY,EAAE,GAAG,EAAE;AACxB,GAAG;AACH,MAAM,IAAI,IAAI,CAAC,YAAY,KAAK,KAAK,CAAC,EAAE,EAAE,OAAO,EAAE;AACnD;AACA,MAAM,IAAI,CAAC,KAAK,KAAK,OAAO,CAAC,KAAK,QAAQ,IAAI,OAAO,CAAC,KAAK,QAAQ,CAAC;AACpE,MAAM;AACN,SAAS,MAAM,IAAI,KAAK,CAAC,CAAC,6EAA6E,CAAC,CAAC,CAAC;AAC1G,OAAO;AACP;AACA,MAAM,IAAI,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,OAAO,GAAG,CAAC;AAClD,MAAM;AACN,SAAS,MAAM,IAAI,SAAS,CAAC,CAAC,+DAA+D,CAAC,CAAC,CAAC;AAChG,OAAO;AACP;AACA,MAAM,IAAI,MAAM,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,OAAO,GAAG,CAAC;AAClD,MAAM;AACN,SAAS,MAAM,IAAI,SAAS,CAAC,CAAC,+DAA+D,CAAC,CAAC,CAAC;AAChG,OAAO;AACP;AACA;AACA,MAAM,IAAI,KAAK,KAAK,KAAK,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,GAAG,CAAC,KAAK,EAAE,WAAW,EAAE,IAAI,CAAC;AACvF,MAAM;AACN,SAAS,MAAM,IAAI,SAAS;AAC5B,UAAU,CAAC,yFAAyF,CAAC,CAAC,CAAC;AACvG,OAAO;AACP;AACA;AACA,MAAM,IAAI,YAAY,KAAK,KAAK,CAAC;AACjC,MAAM;AACN,SAAS,YAAY,GAAG,KAAK,KAAK,KAAK,CAAC,GAAG,KAAK,EAAE,MAAM,EAAE,aAAa,EAAE,WAAW,GAAG,UAAU,CAAC;AAClG,OAAO;AACP;AACA,MAAM,IAAI,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,iBAAiB;AAC5E,MAAM;AACN,SAAS,MAAM,IAAI,SAAS,CAAC,CAAC,0EAA0E,CAAC,CAAC,CAAC;AAC3G,OAAO;AACP;AACA,MAAM,MAAM,WAAW,GAAG,UAAU,CAAC,cAAc,CAAC,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,EAAE,CAAC,CAAC;AACjG;AACA,MAAM,MAAM,QAAQ,GAAG,aAAa,CAAC,MAAM,EAAE,EAAE,OAAO,EAAE,KAAK,EAAE,CAAC,CAAC;AACjE;AACA;AACA,MAAM,IAAI,CAAC,YAAY,GAAG,IAAI,kBAAkB,CAAC;AACjD,SAAS,MAAM,EAAE,YAAY,CAAC,QAAQ,CAAC,IAAI;AAC3C,SAAS,KAAK,EAAE,IAAI;AACpB,SAAS,KAAK,EAAE;AAChB,YAAY,EAAE;AACd,YAAY,CAAC,EAAE,WAAW,CAAC,CAAC;AAC5B,YAAY,CAAC,EAAE,WAAW,CAAC,CAAC;AAC5B,YAAY,OAAO;AACnB,YAAY,OAAO;AACnB,YAAY,KAAK,EAAE,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC;AAC5C,YAAY,WAAW;AACvB,YAAY,OAAO;AACnB,YAAY,MAAM;AAClB,YAAY,iBAAiB,EAAE,EAAE,QAAQ,EAAE,MAAM,EAAE,QAAQ,EAAE;AAC7D,YAAY,MAAM;AAClB,YAAY,YAAY;AACxB,UAAU;AACV,OAAO,CAAC,CAAC;AACT;AACA,MAAM,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE,iBAAiB,EAAE,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC;AACvE;AACA;AACA;AACA,MAAM,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,mBAAmB,EAAE,MAAM,EAAE,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;AACxF,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG,OAAO,aAAa,CAAC,KAAK;AAC7B,GAAG;AACH,MAAM,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,sDAAsD,CAAC,CAAC,CAAC,EAAE;AAChH;AACA,MAAM,MAAM,QAAQ,GAAG,KAAK,CAAC;AAC7B,MAAM,MAAM,SAAS,GAAG,EAAE,CAAC;AAC3B;AACA,MAAM,IAAI,IAAI,GAAG,CAAC,CAAC,CAAC;AACpB;AACA,MAAM,KAAK,MAAM,IAAI,IAAI,QAAQ;AACjC,MAAM;AACN,SAAS,IAAI,EAAE,CAAC;AAChB,SAAS,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,4BAA4B,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE;AACjH;AACA;AACA,SAAS,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,UAAU,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,EAAE,SAAS,EAAE;AACrF,SAAS,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,SAAS,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,SAAS,EAAE;AAClF;AACA,SAAS,IAAI,IAAI,CAAC;AAClB;AACA,SAAS,IAAI,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,GAAG,OAAO,CAAC,EAAE;AACvE,cAAc,IAAI,OAAO,IAAI,CAAC,IAAI,KAAK,QAAQ,EAAE,EAAE,IAAI,GAAG,MAAM,CAAC,EAAE;AACnE,cAAc,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE,EAAE,IAAI,GAAG,OAAO,CAAC,EAAE;AACrE,cAAc,IAAI,IAAI,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,IAAI,CAAC,KAAK,KAAK,KAAK,CAAC,IAAI,OAAO,IAAI,CAAC,KAAK,KAAK,QAAQ,EAAE,EAAE,IAAI,GAAG,OAAO,CAAC,EAAE;AACtH,cAAc,IAAI,OAAO,IAAI,CAAC,SAAS,KAAK,QAAQ;AACpD,SAAS;AACT,YAAY,IAAI,IAAI,CAAC,SAAS,KAAK,IAAI;AACvC,YAAY;AACZ,eAAe,MAAM,IAAI,KAAK;AAC9B,gBAAgB,CAAC,4BAA4B,EAAE,IAAI,CAAC,gEAAgE,CAAC,CAAC,CAAC;AACvH,aAAa;AACb;AACA,YAAY,IAAI,GAAG,cAAc,CAAC;AAClC,UAAU;AACV;AACA,SAAS,IAAI,IAAI,KAAK,KAAK,CAAC,EAAE,EAAE,MAAM,IAAI,SAAS,CAAC,CAAC,6CAA6C,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;AACjH;AACA,SAAS,SAAS,CAAC,IAAI,CAAC,EAAE,GAAG,IAAI,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;AACpD,OAAO;AACP;AACA,MAAM,OAAO,SAAS,CAAC;AACvB,IAAI;AACJ,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;"}